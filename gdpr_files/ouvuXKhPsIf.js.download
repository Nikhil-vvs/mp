if (self.CavalryLogger) { CavalryLogger.start_js(["NnJYh"]); }

__d("CometFeedStoryAsset3DAttachmentStyle_styleTypeRenderer$normalization.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{kind:"SplitOperation",metadata:{},name:"CometFeedStoryAsset3DAttachmentStyle_styleTypeRenderer$normalization",selections:[{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"attachment",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[a,b,{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"binary_cdn_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"fallback_image_cdn_uri",storageKey:null},{alias:null,args:null,concreteType:"Vect2",kind:"LinkedField",name:"fallback_image_dimensions",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"x",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"y",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"fallback_photo",plural:!1,selections:[b,{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[{alias:null,args:[{kind:"Literal",name:"color_choice_algorithm",value:"MOST_PROMINENT_COLOR"},{kind:"Literal",name:"is_computed_if_missing",value:!1}],kind:"ScalarField",name:"accent_color",storageKey:'accent_color(color_choice_algorithm:"MOST_PROMINENT_COLOR",is_computed_if_missing:false)'}],type:"Photo",abstractKey:null}],type:"Media",abstractKey:"__isMedia"}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"low_res_base_64_image_placeholder",storageKey:null},{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"savable_description",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"text",storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Literal",name:"site",value:"www"}],kind:"ScalarField",name:"url",storageKey:'url(site:"www")'}],type:"Asset3D",abstractKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[a,{alias:null,args:null,kind:"ScalarField",name:"is_prod_eligible",storageKey:null}],type:"StoryAttachmentStyleRendererUnion",abstractKey:"__isStoryAttachmentStyleRendererUnion"}]}}();e.exports=a}),null);
__d("CometFeedStoryAsset3DAttachmentStyle_styleTypeRenderer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CometFeedStoryAsset3DAttachmentStyle_styleTypeRenderer",selections:[{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"attachment",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"binary_cdn_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"fallback_image_cdn_uri",storageKey:null},{alias:null,args:null,concreteType:"Vect2",kind:"LinkedField",name:"fallback_image_dimensions",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"x",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"y",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"fallback_photo",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useCometFeedPhotoBackgroundColorRelay_photo"}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"low_res_base_64_image_placeholder",storageKey:null},{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"savable_description",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"text",storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Literal",name:"site",value:"www"}],kind:"ScalarField",name:"url",storageKey:'url(site:"www")'}],type:"Asset3D",abstractKey:null}],storageKey:null}],storageKey:null},{args:null,kind:"FragmentSpread",name:"useCometFeedStoryAttachmentMatchDebugger_storyAttachmentStyleRendererUnion"}],type:"StoryAttachmentAsset3dStyleRenderer",abstractKey:null};e.exports=a}),null);
__d("useWebGLContextVisibility",["HiddenSubtreePassiveContext","React","intersectionObserverEntryIsIntersecting","useIntersectionObserver"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g=b("React");function a(a,c){c===void 0&&(c=Object.freeze({}));var d=g.useContext(b("HiddenSubtreePassiveContext")),e=function(c){var e=d.getCurrentState().hiddenOrBackgrounded_FIXME;b("intersectionObserverEntryIsIntersecting")(c)?a(!0):e||a(!1)};return b("useIntersectionObserver")(e,babelHelpers["extends"]({root:null,rootMargin:{},threshold:0},c))}}),null);
__d("CometFeedStoryAsset3DAttachmentStyle.react",["CometFeedStoryViewportMaxHeightMediaLayout.react","CometImageCover.react","CometLazyPopoverTrigger.react","CometPressable.react","CometRelay","ConstUriUtils","JSResourceForInteraction","React","UserAgent","gkx","recoverableViolation","requireCond","stylex","unrecoverableViolation","useCometFeedPhotoBackgroundColorRelay","useCometFeedStoryAttachmentMatchDebugger","useWebGLContextVisibility","cr:1298198","CometFeedStoryAsset3DAttachmentStyle_styleTypeRenderer.graphql"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g,h,i=b("React"),j=b("gkx")("708253"),k=b("gkx")("678680"),l=b("JSResourceForInteraction")("CometFeedStory3DPhotoContextMenu.react",{"class":"fluid",name:"CometFeedStory3DPhotoContextMenu",oncall:"three_d_photos"}).__setRef("CometFeedStoryAsset3DAttachmentStyle.react"),m={content:{height:"datstx6m",position:"l9j0dhe7"},image:{bottom:"i09qtzwb",end:"n7fi1qx3",position:"pmk7jnqg",start:"j9ispegn",top:"kr520xx4"},mediaPressed:{backgroundColor:"r9n4d945"},root:{borderBottom:"linmgsc8",borderTop:"opwvks06",boxShadow:"g81y0s2s"}},n=584;function a(a){var c,d,e;a=b("CometRelay").useFragment(g!==void 0?g:g=b("CometFeedStoryAsset3DAttachmentStyle_styleTypeRenderer.graphql"),a.styleTypeRenderer);b("useCometFeedStoryAttachmentMatchDebugger")(a);var f=i.useState(!1),o=f[0];f=f[1];f=b("useWebGLContextVisibility")(f,{rootMargin:{bottom:2e3,top:2e3}});var p=a==null?void 0:(a=a.attachment)==null?void 0:a.target;if(p==null)throw b("unrecoverableViolation")("cannot load 3D photo without media target","comet_feed");a=b("useCometFeedPhotoBackgroundColorRelay")(p.fallback_photo);var q=p.fallback_image_cdn_uri,r=p.low_res_base_64_image_placeholder;if(q==null)throw b("unrecoverableViolation")("cannot load 3D photo without static image uri","comet_feed");c=(c=p.fallback_image_dimensions)==null?void 0:c.x;d=(d=p.fallback_image_dimensions)==null?void 0:d.y;(c==null||d==null)&&b("recoverableViolation")("null fallback size was provided for 3d photo","comet_feed");d=c==null||d==null||c===0||d===0?{aspectRatio:1,mediaHeight:1,mediaWidth:1}:{aspectRatio:c/d,mediaHeight:d,mediaWidth:c};c=d.aspectRatio;var s=d.mediaHeight;d=d.mediaWidth;e=((e=p.savable_description)==null?void 0:e.text)||"";var t=p.url,u=p.binary_cdn_uri,v=u!=null&&b("cr:1298198")!=null&&o?i.jsx(b("cr:1298198"),{fileURI:u,height:n/c,width:n}):i.jsx(b("CometImageCover.react"),{alt:e,src:q}),w=i.useCallback(function(){var a,c,d=p.id;if(d!=null){var e;a=(e=b("ConstUriUtils").getUri("/intern/compphoto/x3d/3dphoto_console"))==null?void 0:(e=e.setDomain("our.intern.facebook.com"))==null?void 0:(e=e.setProtocol("https"))==null?void 0:(e=e.addQueryParam("ent_id",d))==null?void 0:e.toString();c=(e=b("ConstUriUtils").getUri("/intern/compphoto/x3d/"+d+"/depth"))==null?void 0:(d=e.setDomain("our.intern.facebook.com"))==null?void 0:(e=d.setProtocol("https"))==null?void 0:e.toString()}var f=function(a,c){var d=/^a$/i.test(a.target.nodeName||""),e=b("UserAgent").isPlatform("Mac OS X")?a.metaKey:a.ctrlKey;d=!d&&k&&e;d&&(a.preventDefault(),c())};return i.jsx(b("CometLazyPopoverTrigger.react"),{popoverProps:{consoleURL:a,depthURL:c,fallbackImgURL:q,fileURL:u},popoverResource:l,children:function(a,c){return i.jsx("div",{onContextMenu:function(a){f(a,c)},ref:a,children:i.jsx("div",{className:(h||(h=b("stylex")))(m.image),children:v})})}})},[u,v,q,p.id]);o=i.jsx("div",{className:(h||(h=b("stylex")))(m.root),ref:f,children:i.jsx(b("CometFeedStoryViewportMaxHeightMediaLayout.react"),{backgroundColor:a,mediaHeight:s,mediaWidth:d,children:function(a){return i.jsxs("div",{className:(h||(h=b("stylex")))(m.content,a),children:[r!=null?i.jsx("div",{className:(h||(h=b("stylex")))(m.image),children:i.jsx(b("CometImageCover.react"),{alt:"",src:"data:image/jpeg;base64,"+r})}):null,k?w():i.jsx("div",{className:(h||(h=b("stylex")))(m.image),children:v})]})}})});return t!=null?i.jsx(b("CometPressable.react"),{display:"block",hideHoverOverlay:!0,linkProps:{rel:j?void 0:"theater",url:t},overlayPressedStyle:m.mediaPressed,children:o}):o}}),null);
__d("createWebGL3DPhotoProgram",["CometWebGLProgram"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g="\nattribute vec3 a_position;\nattribute vec2 a_texcoord_0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nvarying vec2 v_texcoord_0;\n\nvoid main() {\n  v_texcoord_0 = a_texcoord_0;\n  gl_Position = projectionMatrix * viewMatrix * vec4(a_position, 1.0);\n}\n",h="\nprecision mediump float;\n\nvarying vec2 v_texcoord_0;\nuniform sampler2D u_texture_0;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture_0, v_texcoord_0);\n}\n";function a(a){var c=new(b("CometWebGLProgram"))(a);return c.addShader(g,a.VERTEX_SHADER).addShader(h,a.FRAGMENT_SHADER).compile().setUniformDefaults({projectionMatrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],viewMatrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]})}}),null);
__d("createMeshesFromGLTF",["Promise","CometWebGLMesh","CometWebGLTexture","createWebGL3DPhotoProgram"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g={POSITION:"a_position",TEXCOORD_0:"a_texcoord_0"};function a(a,c){var d=[],e=b("createWebGL3DPhotoProgram")(a),f=[],i=c.getMeshes();for(var i=i,j=Array.isArray(i),k=0,i=j?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(j){if(k>=i.length)break;l=i[k++]}else{k=i.next();if(k.done)break;l=k.value}l=l;l=l.primitives;for(var l=l,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=l.length)break;o=l[n++]}else{n=l.next();if(n.done)break;o=n.value}o=o;var p=o.attributes,q=[],r=Infinity,s=0;p=Object.entries(p);for(var t=0;t<p.length;t++){var u=p[t],v=u[0];u=u[1];if(typeof u==="number"){u=c.getAccessor(u);var w=c.getBufferView(u.bufferView);w.byteOffset<r&&(r=w.byteOffset);w.byteOffset+w.byteLength>s&&(s=w.byteOffset+w.byteLength);u=u.byteOffset!=null?u.byteOffset:0;q.push({byteOffset:w.byteOffset+u,name:v})}}q.sort(h);var x=new(b("CometWebGLMesh"))(a,e,{interleaved:!1});w=c.getBinarySource();for(var u=0;u<q.length;u++){v=q[u];if(v.name in g){p=v.byteOffset-r;t={offset:p};x.addAttribute(g[v.name],t)}}x.bufferData(new Float32Array(w.buffer,w.byteOffset+r,(s-r)/4));o.indices!=null&&x.bufferIndex(c.getDataViewForAccessor(o.indices));if(o.material!=null){p=c.getMaterial(o.material);var y=p==null?void 0:(v=p.pbrMetallicRoughness)==null?void 0:(t=v.baseColorTexture)==null?void 0:t.index;y!=null&&(function(){var d=c.getTexture(y),e=c.getImage(d.source),g=new(b("CometWebGLTexture"))(a);f.push(new(b("Promise"))(function(a,b){e.onload=function(){g.setSource(e),a()},e.onerror=function(){b()}}));x.setUniform("u_texture_0",g)})()}d.push(x)}}return b("Promise").all(f).then(function(){return d})}function h(a,b){return a.byteOffset-b.byteOffset}}),null);
__d("glVec3CrossProduct",[],(function(a,b,c,d,e,f){"use strict";e.exports=a;function a(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}}),null);
__d("glMatrixLookingAtTarget",["glVec3CrossProduct"],(function(a,b,c,d,e,f){"use strict";e.exports=a;function a(a,c){c=[a[0]-c[0],a[1]-c[1],a[2]-c[2]];var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]/=d;c[1]/=d;c[2]/=d;d=b("glVec3CrossProduct")([0,1,0],c);var e=b("glVec3CrossProduct")(c,d);return[d[0],d[1],d[2],0,e[0],e[1],e[2],0,c[0],c[1],c[2],0,a[0],a[1],a[2],1]}}),null);
__d("GLTFResource",["unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=[],this.$2=[],this.$3=null,this.$4=null,this.$5=[],this.$6=[],this.$7=[],this.$8=[]}var c=a.prototype;c.addBinarySource=function(a,b,c){this.$3=new Uint8Array(a,b,c)};c.useJSON=function(a){var b;this.$4=(b=a.extras)!=null?b:Object.freeze({});this.$1=(b=a.accessors)!=null?b:[];this.$2=(b=a.bufferViews)!=null?b:[];this.$5=(b=a.images)!=null?b:[];this.$6=(b=a.materials)!=null?b:[];this.$7=(b=a.meshes)!=null?b:[];this.$8=(b=a.textures)!=null?b:[]};c.getBinarySource=function(){if(this.$3==null)throw b("unrecoverableViolation")("attempted to access binary source before it was set","webgl");return this.$3};c.hasBinarySource=function(){return this.$3!=null};c.getAccessor=function(a){a=this.$1[a];if(a==null)throw new(b("unrecoverableViolation"))("accessor index out of range","webgl");return a};c.getBufferView=function(a){a=this.$2[a];if(a==null)throw new(b("unrecoverableViolation"))("buffer view index out of range","webgl");return a};c.getExtras=function(){return this.$4};c.getMaterial=function(a){a=this.$6[a];if(a==null)throw new(b("unrecoverableViolation"))("material index out of range","webgl");return a};c.getMeshes=function(){return this.$7};c.getTexture=function(a){a=this.$8[a];if(a==null)throw new(b("unrecoverableViolation"))("texture index out of range","webgl");return a};c.getDataViewForAccessor=function(a){a=this.$1[a];if(a==null)throw new(b("unrecoverableViolation"))("accessor index out of range","webgl");var c=this.$2[a.bufferView];if(c==null)throw new(b("unrecoverableViolation"))("buffer view index out of range","webgl");if(c.buffer!==0)throw new(b("unrecoverableViolation"))("external gltf buffers are not currently supported","webgl");var d=this.$3;if(d==null)throw new(b("unrecoverableViolation"))("attempted to get an accessor before loading binary data","webgl");var e=d.byteOffset+c.byteOffset;switch(a.componentType){case 5120:return new Int8Array(d.buffer,e,c.byteLength);case 5121:return new Uint8Array(d.buffer,e,c.byteLength);case 5122:return new Int16Array(d.buffer,e,c.byteLength/2);case 5123:return new Uint16Array(d.buffer,e,c.byteLength/2);case 5124:return new Int32Array(d.buffer,e,c.byteLength/4);case 5125:return new Uint32Array(d.buffer,e,c.byteLength/4);case 5126:return new Float32Array(d.buffer,e,c.byteLength/4);default:throw new(b("unrecoverableViolation"))("unsupported gl component type","webgl")}};c.getImage=function(a){a=this.$5[a];var b=this.getBufferView(a.bufferView),c=this.getBinarySource();c=new Uint8Array(c.buffer,c.byteOffset+b.byteOffset,b.byteLength);b=new Blob([c],{type:a.mimeType});c=URL.createObjectURL(b);a=new Image();a.src=c;return a};return a}();e.exports=a}),null);
__d("GLTFTypesValidator",["unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";f.throwBadFormat=g;f.validateAccessor=h;f.validateAccessors=i;f.validateArray=j;f.validateBoolean=a;f.validateBuffer=k;f.validateBufferView=l;f.validateBufferViews=m;f.validateBuffers=n;f.validateExtras=o;f.validateGLTFBodyJSON=c;f.validateImage=p;f.validateImages=q;f.validateInteger=r;f.validateMaterial=s;f.validateMaterials=t;f.validateMesh=u;f.validateMeshes=v;f.validatePrimitive=w;f.validatePrimitives=x;f.validateString=y;f.validateTexture=z;f.validateTextures=A;function g(a){throw new(b("unrecoverableViolation"))("unrecoverable incorrectly formatted JSON ".concat(a),"webgl")}function h(a){a===void 0&&g("GLTFAccessor undefined"),r(a.bufferView,!0,"GLTFAccessor.bufferView",0),r(a.byteOffset,!1,"GLTFAccessor.byteOffset",0),r(a.componentType,!0,"GLTFAccessor.componentType",5120,5126),r(a.count,!0,"GLTFAccessor.count",1),a.type!==void 0&&(a.type!=="SCALAR"&&a.type!=="VEC2"&&a.type!=="VEC3"&&a.type!=="VEC4"&&g("GLTFAccessor malformed"))}function i(a){j(a,!0,"GLTFAccessor");if(a!==void 0)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;h(d)}}function j(a,b,c){if(a===void 0)if(b)g("Array<".concat(c).concat("> undefined"));else return;else a.length===0&&g("Array<".concat(c).concat("> length=0"))}function a(a,b,c){if(a===void 0)if(b)g(c.concat(" undefined"));else return;typeof a!=="boolean"&&g(c.concat(" not a boolean"))}function k(a){a===void 0&&g("GLTFBuffer undefined"),r(a.byteLength,!0,"GLTFBuffer.byteLength",1)}function l(a){r(a.buffer,!0,"GLTFBufferView.buffer",0),r(a.byteOffset,!0,"GLTFBufferView.byteOffset",0),r(a.byteLength,!0,"GLTFBufferView.byteLength",0)}function m(a){j(a,!1,"GLTFBufferView");if(a!==void 0)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;l(d)}}function n(a){j(a,!1,"GLTFBuffer");if(a!==void 0)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;k(d)}}function o(a){a!==void 0&&(a.FB_PHOTO_3D_DATA!==void 0?(a.FB_PHOTO_3D_DATA.hFov!==void 0&&r(a.FB_PHOTO_3D_DATA.hFov,!1,"GLTFExtras.FB_PHOTO_3D_DATA.hFov"),a.FB_PHOTO_3D_DATA.vFov!==void 0&&r(a.FB_PHOTO_3D_DATA.vFov,!1,"GLTFExtras.FB_PHOTO_3D_DATA.vFov")):g("GLTFExtras undefined"))}function c(a){a!==void 0?(i(a.accessors),n(a.buffers),m(a.bufferViews),o(a.extras),q(a.images),t(a.materials),v(a.meshes),A(a.textures)):g("GLTFBody undefined")}function p(a){a===void 0&&g("GLTFImage undefined"),y(a.mimeType,!0,"GLTFImage.mimeType"),r(a.bufferView,!0,"GLTFImage.bufferView",0)}function q(a){j(a,!1,"GLTFImage");if(a!==void 0)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;p(d)}}function r(a,b,c,d,e){d===void 0&&(d=Number.MIN_SAFE_INTEGER);e===void 0&&(e=Number.MAX_SAFE_INTEGER);if(a===void 0)if(b)g(c.concat(" undefined"));else return;typeof a==="number"?(a<d||a>e)&&g(c.concat(" out of range")):g(c.concat(" not an integer"))}function s(a){a===void 0&&g("GLTFMaterial undefined"),a.pbrMetallicRoughness!==void 0&&(a.pbrMetallicRoughness.baseColorTexture!==void 0&&r(a.pbrMetallicRoughness.baseColorTexture.index,!1,"GLTFMaterial.pbrMetallicRoughness.baseColorTexture.index",0))}function t(a){j(a,!1,"GLTFMaterial");if(a!==void 0)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;s(d)}}function u(a){a===void 0&&g("GLTFMesh undefined"),x(a.primitives)}function v(a){j(a,!0,"GLTFMesh");if(a!==void 0)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;u(d)}}function w(a){a===void 0&&g("GLTFPrimitive undefined");for(var b in a.attributes)Object.prototype.hasOwnProperty.call(a.attributes,b)&&(b==="POSITION"||b==="TEXCOORD_0"||b==="TEXCOORD_1"?r(a.attributes[b],!0,"GLTFPrimitives.attributes[".concat(b).concat("]"),0):g("GLTFPrimitive malformed"));r(a.indices,!1,"GLTFPrimitives.indicies",0);r(a.material,!1,"GLTFPrimitives.material",0)}function x(a){a===void 0&&g("GLTFPrimatives undefined");j(a,!0,"GLTFPrimitive");for(var b=0;b<a.length;b++){var c=a[b];w(c)}}function y(a,b,c){if(a===void 0)if(b)g(c.concat(" undefined"));else return;typeof a!=="string"&&g(c.concat(" not a string"))}function z(a){a===void 0&&g("GLTFTexture undefined"),r(a.sampler,!0,"GLTFTexture.sampler",0),r(a.source,!0,"GLTFTexture.source",0)}function A(a){j(a,!0,"GLTFTexture");if(a!==void 0)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;z(d)}}}),null);
__d("parseGLBResource",["GLTFResource","GLTFTypesValidator","extractUTF8StringFromBuffer","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g=1179937895;function a(a){var c=new DataView(a);if(c.getUint32(0,!0)!==g)throw new(b("unrecoverableViolation"))("invalid GLB magic number","webgl");if(c.getUint32(4,!0)!==2)throw new(b("unrecoverableViolation"))("unsupported GLB version number","webgl");var d=c.getUint32(8,!0);if(d>a.byteLength)throw new(b("unrecoverableViolation"))("glb buffer is shorter than declared byte length","webgl");var e=new(b("GLTFResource"))(),f=12;while(f<d){var h=c.getUint32(f,!0),i=c.getUint32(f+4,!0);switch(i){case 1313821514:i=b("extractUTF8StringFromBuffer")(a,f+8,h);var j="";try{j=JSON.parse(i)}catch(a){throw new(b("unrecoverableViolation"))("failed to parse glTF JSON","webgl",a)}b("GLTFTypesValidator").validateGLTFBodyJSON(j);e.useJSON(j);break;case 5130562:e.addBinarySource(a,f+8,h);break;default:throw new(b("unrecoverableViolation"))("unexpected GLB section label","webgl")}f+=h+8}return e}}),null);
__d("useGLBLoadAndParse",["React","parseGLBResource","promiseDone"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g=b("React");function a(a){var c=g.useState(null),d=c[0],e=c[1];g.useEffect(function(){var c=!1;b("promiseDone")(window.fetch(a).then(function(a){return a.arrayBuffer()}).then(function(a){if(c)return;a=b("parseGLBResource")(a);e(a)})["catch"](function(){e(null)}));return function(){c=!0}},[a]);return d}}),null);
__d("useGLTFDerivedFOV",["React"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g=b("React"),h=1,i=.508015513,j=.666488587,k=.925,l=Object.freeze({landscape:-.14,portrait:-.124}),m=Object.freeze({landscape:-.124,portrait:-.112}),n=Object.freeze({landscape:.96,portrait:.8}),o=Object.freeze({landscape:.6,portrait:.7});function a(a){var b=g.useMemo(function(){var b;b=(b=a==null?void 0:(b=a.getExtras())==null?void 0:(b=b.FB_PHOTO_3D_DATA)==null?void 0:b.vFov)!=null?b:j;return b*k},[a]),c=g.useMemo(function(){var b;b=(b=a==null?void 0:(b=a.getExtras())==null?void 0:(b=b.FB_PHOTO_3D_DATA)==null?void 0:b.hFov)!=null?b:i;return b*k},[a]),d=g.useMemo(function(){var a=.1,d=1e3,e=1/Math.tan(b/2),f=c/b;return[e/f,0,0,0,0,e,0,0,0,0,(a+d)/(a-d),-1,0,0,a*d*2/(a-d),0]},[c,b]),e=g.useMemo(function(){var a=c>b?"landscape":"portrait",d=l[a],e=m[a];return[Math.tan(c/2)*h*d,Math.tan(b/2)*h*e,1-n[a],o[a]]},[c,b]),f=e[0],p=e[1],q=e[2];e=e[3];return{hFov:c,maxHorizontalAngle:f,maxVerticalAngle:p,projectionMatrix:d,targetInteractionWeightHorizontal:q,targetScrollWeightVertical:e,vFov:b}}}),null);
__d("Comet3DPhotoViewer.react",["fbt","CometFeedStoryImmersiveMediaMouseOverlay.react","Matrices","React","clearTimeout","createMeshesFromGLTF","glMatrixLookingAtTarget","mergeRefs","promiseDone","setTimeout","useFrameTiming","useGLBLoadAndParse","useGLContext","useGLTFDerivedFOV","useThrottled","useVisibilityObserver"],(function(a,b,c,d,e,f,g){"use strict";e.exports=a;var h=b("React"),i=1,j=.01,k=.005,l=.1,m=.06,n=.12;function a(a){var c=a.fileURI,d=a.height,e=a.onLoad;a=a.width;var f=h.useState(!1),o=f[0],p=f[1],q=h.useRef(null);f=b("useGLContext")(a,d,{expand:!0});var r=f[0],s=f[1];a=b("useFrameTiming")();var t=a[0],u=b("useGLBLoadAndParse")(c);d=h.useState([]);var v=d[0],w=d[1];h.useEffect(function(){if(r==null||u==null)return;var a=!1;b("promiseDone")(b("createMeshesFromGLTF")(r,u).then(function(b){if(a)return;w(b);e&&e()}));return function(){a=!0}},[r,u,e]);f=b("useGLTFDerivedFOV")(u);var x=f.hFov,y=f.maxHorizontalAngle,z=f.maxVerticalAngle,A=f.projectionMatrix,B=f.targetInteractionWeightHorizontal,C=f.targetScrollWeightVertical,D=f.vFov,E=h.useCallback(function(){if(r==null||v.length===0)return;r.enable(r.DEPTH_TEST);r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);r.enable(r.BLEND);r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var a=v,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;d.program.use();d.draw()}},[v,r]),F=function(){b("clearTimeout")(q.current),q.current=b("setTimeout")(function(){p(!0)},3e3)};a=function(){o&&p(!1),F()};var G=b("useThrottled")(a,100),H=b("useVisibilityObserver")({onVisible:function(){b("clearTimeout")(q.current),q.current=b("setTimeout")(function(){p(!0)},3e3)}});c=h.useMemo(function(){return b("mergeRefs")(s,H)},[s,H]);h.useEffect(function(){return function(){b("clearTimeout")(q.current)}},[]);var I=h.useRef([0,0]),J=h.useRef(1),K=h.useRef(1),L=h.useRef([0,0]),M=h.useRef([0,0]),N=h.useRef(0),O=h.useCallback(function(a){if(r==null)return;if(a!=null){if(N.current!==0){var c=Math.min(a-N.current,50);c=Math.max(Math.min(k*c,1),0);var d=L.current,e=d[0];d=d[1];var f=M.current,g=f[0];f=f[1];M.current=[g+c*(e-g),f+c*(d-f)];g=J.current;f=K.current;K.current=f+c*(g-f);(Math.abs(M.current[0]-e)>j||Math.abs(M.current[1]-d)>j||Math.abs(K.current-g)>j)&&t(O)}N.current=a}c=K.current;f=D*n*(2*c-1);e=(1-2*c)*z;d=M.current;g=d[0];a=d[1];d=Math.sin(g*Math.PI*.5);g=Math.sin(a*Math.PI*.5);a=D*m*g;var h=x*m*d;d=-d*y;g=-g*z;c=Math.pow(c+.16,3)/(Math.pow(c+.16,3)+Math.pow(1-(c+.16),3))-.9;a=-(a+f);f=-h;h=i-c*l;c=[0+h*Math.cos(a)*Math.sin(f),0+h*Math.sin(a),-i+h*Math.cos(a)*Math.cos(f)];h=[-(B*d),-(e*C+g*(1-C)),-i];a=b("glMatrixLookingAtTarget")(c,h);f=b("Matrices").invertMat4(a);for(var d=v,e=Array.isArray(d),g=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(e){if(g>=d.length)break;c=d[g++]}else{g=d.next();if(g.done)break;c=g.value}h=c;h.setUniform("viewMatrix",f);h.setUniform("projectionMatrix",A)}E()},[E,r,x,y,z,v,A,t,B,C,D]),P=h.useCallback(function(){if(r==null)return;var a=r.canvas,b=0,c=0;while(a!=null)b+=a instanceof HTMLElement?a.offsetLeft:0,c+=a instanceof HTMLElement?a.offsetTop:0,a=a instanceof HTMLElement?a.offsetParent:null;I.current=[b,c]},[I,r]),Q=h.useCallback(function(){var a;if(r==null)return;P();var b=window.innerHeight,c=r.canvas.clientHeight;b=b+c;a=I.current[1]-((a=(a=document.scrollingElement)==null?void 0:a.scrollTop)!=null?a:0)+c;c=a/b;J.current=c;if(c<0||c>1)return;t(O)},[I,r,t,O,P]);d=h.useCallback(function(a){if(r==null)return;P();var b=a.pageX;a=a.pageY;b=b-I.current[0];a=a-I.current[1];b=2*b/r.canvas.clientWidth-1;a=1-2*a/r.canvas.clientHeight;L.current=[b,a];G();if(b<-1||a<-1||b>1||a>1)return;t(O)},[r,L,t,G,O,P]);h.useEffect(function(){document.addEventListener("scroll",Q);O();return function(){document.removeEventListener("scroll",Q)}},[O,Q]);return h.jsx("div",{onMouseMove:d,ref:c,children:h.jsx(b("CometFeedStoryImmersiveMediaMouseOverlay.react"),{descriptionFbt:g._("Move your mouse to view the photo in 3D"),isActive:o,showClick:!1})})}}),null);